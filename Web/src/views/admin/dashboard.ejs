<!-- src/views/admin/dashboard.ejs -->
<%- include('../layouts/top', {
  active,
  title: 'Connect Health ‚Äî Dashboard',
  pageCss: ['/public/css/admin_css/pages/dashboard.css']
}) %>

<section class="dashboard">

  <!-- KPIs principais -->
  <div class="dashboard__stats">
    <div class="card stat-card">
      <strong><%= (stats && stats.totalUsers) || 0 %></strong>
      <span>Usu√°rios Cadastrados</span>
    </div>
    <div class="card stat-card">
      <strong><%= (stats && stats.scheduled) || 0 %></strong>
      <span>Agendamentos Marcados</span>
    </div>
    <div class="card stat-card">
      <strong><%= (stats && stats.finished) || 0 %></strong>
      <span>Agendamentos Conclu√≠dos</span>
    </div>
    <div class="card stat-card">
      <canvas id="chartAtendimentos"></canvas>
    </div>
  </div>

  <!-- √Årea inferior -->
  <div class="dashboard__content">
    <!-- Agendamentos Pendentes -->
    <div class="card content-card">
      <h3>Agendamentos Pendentes</h3>

      <div class="appointments-list">
        <% (pendings || []).forEach(p => { %>
          <div class="appointment-item">
            <div class="info">
              <strong><%= p.user %></strong>
              <span><%= p.service %></span>
              <small><%= p.date %> ‚Äî <%= p.time %></small>
            </div>
            <div class="actions">
              <button class="btn-accept">Aceitar</button>
              <button class="btn-reject">Recusar</button>
            </div>
          </div>
        <% }) %>

        <% if (!(pendings || []).length) { %>
          <p class="muted" style="margin-top:8px;">Sem agendamentos pendentes.</p>
        <% } %>
      </div>
    </div>

    <!-- Status de atendimentos -->
    <div class="card content-card">
      <h3>Status dos Atendimentos</h3>
      <ul class="attendances-list">
        <li>
          <strong>Maria Pereira</strong> ‚Äî <span class="status success">Atendida</span> <br>
          <small>Respons√°vel: Dr. Juliana Costa</small>
        </li>
        <li>
          <strong>Lucas Moraes</strong> ‚Äî <span class="status danger">Cancelou</span> <br>
          <small>Cancelado por: Secretaria</small>
        </li>
      </ul>
    </div>

    <!-- Disponibiliza√ß√£o de hor√°rios -->
    <div class="card content-card">
      <h3>Disponibilizar Hor√°rios de Atendimento</h3>
      <form class="schedule-form">
        <div class="form-row">
          <input type="date" name="data" required />
          <input type="time" name="horaInicio" required />
          <input type="time" name="horaFim" required />
          <button type="submit" class="btn btn-primary">Adicionar</button>
        </div>
      </form>

      <ul class="schedule-list">
        <li>üïì 10:00 - 11:00 ‚Äî Dispon√≠vel</li>
        <li>üïê 14:00 - 15:00 ‚Äî Dispon√≠vel</li>
      </ul>
    </div>

  </div>
</section>

<%- include('../layouts/bottom') %>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  (function () {
    const el = document.getElementById('chartAtendimentos');
    if (!el) return;
    const ctx = el.getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex'],
        datasets: [{
          label: 'Atendimentos da Semana',
          data: [4, 6, 3, 7, 5],
          borderRadius: 8,
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          x: { ticks: { color: '#cbd5e1' }, grid: { display: false } },
          y: { ticks: { color: '#64748b' }, grid: { color: '#1e293b' } }
        }
      }
    });
  })();
</script>
