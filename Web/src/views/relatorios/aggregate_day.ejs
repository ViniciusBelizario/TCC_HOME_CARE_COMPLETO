<%- include('../layouts/top', { active: 'reports', title: 'Relatórios — Consultas por dia' }) %>
<div class="card" style="max-width:1080px;margin:0 auto;">
  <h3>Consultas por DIA (agregado)</h3>

  <form method="GET" action="/admin/relatorios/consultas-dia" class="form" style="display:grid;gap:10px;margin-bottom:12px;">
    <div class="form-grid" style="grid-template-columns:1fr 1fr;">
      <input class="input" type="datetime-local" name="from" value="<%= filters.from || '' %>" required />
      <input class="input" type="datetime-local" name="to"   value="<%= filters.to   || '' %>" required />
    </div>
    <div class="form-grid" style="grid-template-columns:1fr 1fr;">
      <input class="input" type="text" name="doctorId" value="<%= filters.doctorId || '' %>" placeholder="ID do médico (opcional)" />
      <select class="input" name="format">
        <option value="json" <%= (filters.format||'json')==='json' ? 'selected' : '' %>>json</option>
        <option value="csv"  <%= (filters.format||'json')==='csv'  ? 'selected' : '' %>>csv</option>
      </select>
    </div>
    <div class="form-actions" style="justify-content:flex-end;">
      <a class="btn" href="/admin/relatorios">Voltar</a>
      <button class="btn btn-primary" type="submit">Gerar</button>
    </div>
  </form>

  <% if (error) { %><p class="msg-error"><%= error %></p><% } %>

  <% if ((items||[]).length) { %>
    <div class="card" style="overflow:auto;">
      <table class="table">
        <thead>
          <tr>
            <% Object.keys(items[0]).forEach(k => { %><th><%= k %></th><% }) %>
          </tr>
        </thead>
        <tbody>
          <% items.forEach(r => { %>
            <tr>
              <% Object.keys(items[0]).forEach(k => { %><td><%= r[k] %></td><% }) %>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } else if (!error && typeof items !== 'undefined') { %>
    <p class="muted">Sem dados para este intervalo.</p>
  <% } %>
</div>
<%- include('../layouts/bottom') %>
